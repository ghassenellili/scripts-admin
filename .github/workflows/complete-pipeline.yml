unit-tests:
    name: ðŸ§ª Tests unitaires
    runs-on: ubuntu-latest
    needs: [syntax-check, permissions-check]
    
    steps:
      - name: Checkout du code
        uses: actions/checkout@v4
      
      - name: PrÃ©parer l'environnement de test
        run: |
          echo "ðŸ§ª PHASE 3 : Tests unitaires"
          echo "=========================================="
          
          mkdir -p test-env
          cd test-env
          echo "Contenu de test" > test-file.txt
          echo "Log de test" > test.log
          mkdir -p test-backup
          
          echo "âœ… Environnement de test crÃ©Ã©"
      
      - name: Test 1 - VÃ©rifier que les scripts sont lisibles
        run: |
          echo ""
          echo "ðŸ“‹ Test 1 : LisibilitÃ© des scripts"
          for script in *.sh; do
            if [ -f "$script" ]; then
              if [ -r "$script" ]; then
                echo "âœ… $script est lisible"
              else
                echo "âŒ $script n'est pas lisible"
                exit 1
              fi
            fi
          done
      
      - name: Test 2 - VÃ©rifier la prÃ©sence du shebang
        run: |
          echo ""
          echo "ðŸ“‹ Test 2 : PrÃ©sence du shebang"
          
          failed=0
          for script in *.sh; do
            if [ -f "$script" ]; then
              first_line=$(head -n 1 "$script")
              if [[ "$first_line" == "#!/bin/bash"* ]]; then
                echo "âœ… $script : shebang prÃ©sent"
              else
                echo "âš ï¸  $script : shebang manquant ou incorrect"
                echo "   PremiÃ¨re ligne : $first_line"
                failed=1
              fi
            fi
          done
          
          if [ $failed -eq 1 ]; then
            echo "âš ï¸  Certains scripts n'ont pas de shebang correct"
          fi
      
      - name: Test 3 - VÃ©rifier l'absence de commandes dangereuses
        run: |
          echo ""
          echo "ðŸ“‹ Test 3 : DÃ©tection de commandes dangereuses"
          
          dangerous_found=0
          
          for script in *.sh; do
            if [ -f "$script" ]; then
              if grep -q "rm -rf /" "$script" 2>/dev/null; then
                echo "âš ï¸  $script contient 'rm -rf /'"
                dangerous_found=1
              fi
              
              if grep -q "mkfs" "$script" 2>/dev/null; then
                echo "âš ï¸  $script contient 'mkfs'"
                dangerous_found=1
              fi
              
              if grep -q "dd if=" "$script" 2>/dev/null; then
                echo "âš ï¸  $script contient 'dd if='"
                dangerous_found=1
              fi
            fi
          done
          
          if [ $dangerous_found -eq 0 ]; then
            echo "âœ… Aucune commande dangereuse dÃ©tectÃ©e"
          else
            echo "âš ï¸  Commandes dangereuses dÃ©tectÃ©es"
          fi
      
      - name: Test 4 - Simuler l'exÃ©cution
        run: |
          echo ""
          echo "ðŸ“‹ Test 4 : Simulation d'exÃ©cution"
          
          chmod +x *.sh 2>/dev/null || true
          
          if [ -f "monitor.sh" ]; then
            echo "ðŸ§ª Test de monitor.sh..."
            timeout 5 bash monitor.sh > /tmp/monitor-output.txt 2>&1 || true
            echo "âœ… monitor.sh testÃ©"
          fi
          
          echo "âœ… Tests de simulation terminÃ©s"
      
      - name: RÃ©sumÃ© des tests
        run: |
          echo ""
          echo "=========================================="
          echo "ðŸ“Š RÃ‰SUMÃ‰ DES TESTS UNITAIRES"
          echo "=========================================="
          echo "âœ… Test 1 : LisibilitÃ© - PASSÃ‰"
          echo "âœ… Test 4 : ExÃ©cution - SIMULÃ‰"
          echo "=========================================="
          echo "âœ… Tous les tests unitaires sont terminÃ©s !"          echo "âœ… Test 2 : Shebang - VÃ‰RIFIÃ‰"

